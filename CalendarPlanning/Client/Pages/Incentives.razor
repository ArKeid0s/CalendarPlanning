@page "/incentives"
@using CalendarPlanning.Client.Components.Incentive
@using CalendarPlanning.Shared.Models.DTO;
@inject IIncentivesService IncentivesService
@inject AuthenticationStateProvider AuthenticationStateProvider

<PageTitle>Incentives</PageTitle>

<AuthorizeView>
    <Authorized>
        <CreateIncentive OnIncentiveCreated=@RefreshIncentives />
        <IncentiveList Incentives="@_incentives" />
    </Authorized>

    <NotAuthorized>
        <MudAlert Severity="Severity.Error">You are not allowed to view this page.</MudAlert>
    </NotAuthorized>
</AuthorizeView>

@code {
    private List<IncentiveDto>? _incentives;

    private async Task RefreshIncentives()
    {
        var (userId, isAdmin) = await IncentivesService.GetUserRoleDetails();
        _incentives = await IncentivesService.LoadIncentivesAsync(isAdmin, userId);
        StateHasChanged();
    }
}